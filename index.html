<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>元宵灯谜会</title>
    <script src="./js/data.js"></script>
    <script src="./js/phaser.min.js"></script>
</head>
<body>
    
</body>
<script>
    var game = new Phaser.Game(800,600,Phaser.CANVAS);
            var score = 0;
            var timer = 0;   
            var index = 0;
            var bl = false
     
    var scene = function(game) {
        this.init = function(){
            score = 0;
            timer = 30;   
            index = 0;
            bl = false
        };
        this.preload = function(){
            this.load.image('bg','./images/bg.png')
            this.load.image('start','./images/btn.png')
            this.load.image('replay','./images/re.png')
            this.load.image('sp','./images/sp.png')
            this.load.image('board','./images/board.png')
        };
        this.create = function(){
            this.bg = this.add.image(0,0,'bg')
            this.bg.width = game.width;
            this.bg.height = game.height;
            this.start = game.add.image(0,0,'start');
            this.start.anchor.set(.5);
            this.start.x =this.world.centerX;
            this.start.y = this.world.centerY*(1.5);
            this.start.inputEnabled = true;
            this.start.events.onInputDown.addOnce(function(){
                this.ps.alpha = 1;
                this.ps.x = 0;
                bl = true
                this.start.destroy();
            },this);
            this.ps = this.add.group();
            this.ps.x= 800
            // this.ps.setAll('inputEnabled','true')
            this.ps.alpha = 0;
            for (var i=0; i<12; i++){
                this.ps.create(80,80,'sp');
            }
            for (var i=1; i<12; i++){
                if (i%8==0){
                    this.ps.getChildAt(i).x = this.ps.getChildAt(0).x;
                    this.ps.getChildAt(i).y = this.ps.getChildAt(i-1).y+this.ps.getChildAt(i-1).height;
                }else{
                    this.ps.getChildAt(i).x = this.ps.getChildAt(i-1).x+this.ps.getChildAt(i-1).width;
                    this.ps.getChildAt(i).y = this.ps.getChildAt(i-1).y;
                }
            }
            for (let i=0; i<this.ps.length; i++){
                this.ps.getChildAt(i).inputEnabled = true
                this.ps.getChildAt(i).events.onInputDown.addOnce(function(){
                        index = i;
                        this.ps.x= 800;
                        this.container.alpha=1
                        this.container.x = 0;
                        this.miti.text = data[i].谜题;
                        var r = this.rnd.between(1,2)
                        if(r==1){
                            this.left.text = data[i].谜底;
                            this.right.text = data[i].干扰项
                        }else{
                            this.right.text = data[i].谜底;
                            this.left.text = data[i].干扰项
                        }
                        // console.log(data[i])
               },this)
            }
            this.container = this.add.group();
            this.board = this.add.image(0,0,'board');
            this.board.anchor.set(.5);
            this.board.scale.set(1.1,1.5);
            this.board.x = this.world.centerX
            this.board.y = this.world.centerY
            this.board.alpha = 1
            this.miti = this.add.text(0,0,'data',{fill:'white'})
            this.miti.x = 250
            this.miti.y = 170
            this.left = this.add.text(0,0,'data',{fill:'white'})
            this.right = this.add.text(0,0,'data',{fill:'white'})
            this.left.x = 200
            this.left.y = 300
            this.right.x = 500
            this.right.y = 300
            this.container.add(this.board);
            this.container.add(this.miti);
            this.container.add(this.left);
            this.container.add(this.right);
            this.container.alpha = 0
            this.left.inputEnabled = true;
            this.right.inputEnabled = true;
            this.left.events.onInputDown.add(function(){
                if(data[index].谜底==this.left.text){
                    score++;
                   
                }else{
                    console.log(index)
                    this.ps.getChildAt(index).kill();
                    
                }
                // console.log(score)
                this.container.x = 800;
                this.ps.x =0
            },this)
            this.right.events.onInputDown.add(function(){
                if(data[index].谜底==this.right.text){
                    score++;
                    
                }else{
                    console.log(index)
                    this.ps.getChildAt(index).kill();
                }
                // console.log(score)
                this.container.x = 800;
                this.ps.x =0
            },this)
            this.score = this.add.text(0,0,'score'+score,{fill:'white'});
            this.timer = this.add.text(this.world.centerX,50,timer,{fill:'white',font:'54px'});
            this.timer.anchor.set(0.5);
        };
        var dt = 0;
        this.update = function(){
            if(bl==false){
                return false
            }
            dt++
            if(dt%60==0){
                timer--;
                console.log(timer)
                this.timer.text = timer;
                if(timer==0){
                    game.state.start('over')
                }
            }
            this.score.text = 'score:' + score ;
            
        };
    }

    var over = function(game){
        this.create = function(){
            this.bg = this.add.image(0,0,'bg')
            this.bg.width = game.width;
            this.bg.height = game.height;
            this.start = game.add.image(0,0,'replay');
            this.start.anchor.set(.5);
            this.start.x =this.world.centerX;
            this.start.y = this.world.centerY*(1.5);
            this.start.inputEnabled = true;
            this.start.events.onInputDown.addOnce(function(){
               game.state.start('scene')
            },this);
            this.score = this.add.text(0,0, score,{fill:'brown',font:'100px'});
            this.score.anchor.set(.5);
            this.score.x = this.world.centerX;
            this.score.y = this.world.centerY * 0.72;
        };
    }

    game.state.add('over',over);
    game.state.add('scene',scene);
    game.state.start('scene');
    
</script>
</html>